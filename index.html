<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÙØ±Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… â€” Ø´Ø±Ú©Øª Ø®Ø¯Ù…Ø§Øª Ù‡ÙˆØ§ÛŒÛŒ Ø³Ø§Ù…Ø§Ù† - Ø§ØµÙÙ‡Ø§Ù†</title>

  <!-- Persian datepicker (Ø¨Ø±Ø§ÛŒ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css">
  <style>
    :root{
      --accent: #0b67a9;
      --card: #ffffff;
      --bg: #f3f7fb;
      --muted: #666;
      --danger: #d9534f;
    }
    * {box-sizing: border-box}
    body{
      font-family: "Vazir", "Tahoma", "Segoe UI", sans-serif;
      background: var(--bg);
      margin:0;
      padding:20px;
      color:#222;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .container{
      max-width:1100px;
      margin:0 auto;
    }
    header{
      background: linear-gradient(90deg,#0b67a9,#1e9bd7);
      color:white;
      padding:20px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(11,103,169,0.18);
      margin-bottom:18px;
    }
    header h1{margin:0;font-size:20px}
    .card{
      background:var(--card);
      padding:16px;
      border-radius:10px;
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
      margin-bottom:14px;
    }
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:12px;
      align-items:center;
    }
    label{display:block;margin-bottom:6px;font-weight:600}
    input[type="text"], input[type="tel"], input[type="number"], select, textarea, .date-input {
      width:100%;
      padding:10px 12px;
      border:1px solid #ddd;
      border-radius:8px;
      font-size:14px;
    }
    textarea{min-height:80px; resize:vertical}
    .row{display:flex;gap:8px;align-items:center}
    .small{font-size:13px;color:var(--muted)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    button{
      background:var(--accent);
      color:white;
      padding:10px 14px;
      border:0;border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }
    button.secondary{background:#eee;color:#222}
    .danger{background:var(--danger)}
    .muted{background:#fafafa;color:#333;border:1px solid #eee}
    .section-title{font-size:16px;margin-bottom:8px;color:#0b67a9}
    .employment-list{margin-top:8px}
    .employment-item{border:1px dashed #e0e0e0;padding:10px;border-radius:8px;margin-bottom:8px;background:#fcfeff}
    .inline{display:flex;gap:8px}
    .preview{white-space:pre-wrap; font-family:inherit; font-size:14px}
    .required{color:var(--danger);margin-left:6px}
    .footer{
      display:flex;justify-content:space-between;gap:8px;align-items:center;margin-top:12px;
    }
    @media (max-width:640px){
      .row{flex-direction:column;align-items:stretch}
      .footer{flex-direction:column;align-items:stretch}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ÙØ±Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… â€” Ø´Ø±Ú©Øª Ø®Ø¯Ù…Ø§Øª Ù‡ÙˆØ§ÛŒÛŒ Ø³Ø§Ù…Ø§Ù† - Ø§ØµÙÙ‡Ø§Ù†</h1>
      <p class="small" style="margin-top:6px">Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø³ØªØ§Ø±Ù‡â€ŒØ¯Ø§Ø± Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ú©Ù†ÛŒØ¯.</p>
    </header>

    <form id="applyForm" class="card" autocomplete="off">
      <!-- Ø´Ø®ØµÛŒ -->
      <div>
        <div class="section-title">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</div>
        <div class="grid">
          <div>
            <label>Ù†Ø§Ù… <span class="required">*</span></label>
            <input type="text" id="firstName" required>
          </div>
          <div>
            <label>Ú©Ø§Ø¯Ø± Ø¬Ù„Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ <span class="required">*</span></label>
            <input type="text" id="lastName" required>
          </div>
          <div>
            <label>Ù†Ø§Ù… Ù¾Ø¯Ø±</label>
            <input type="text" id="fatherName">
          </div>
          <div>
            <label>Ú©Ø¯ Ù…Ù„ÛŒ <span class="required">*</span></label>
            <input type="text" id="nationalId" pattern="\d{10}" title="10 Ø±Ù‚Ù… Ú©Ø¯Ù…Ù„ÛŒ" required>
          </div>
          <div>
            <label>Ø´Ù…Ø§Ø±Ù‡ Ø´Ù†Ø§Ø³Ù†Ø§Ù…Ù‡</label>
            <input type="text" id="shenasnameh">
          </div>
          <div>
            <label>ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯ (Ø´Ù…Ø³ÛŒ) <span class="required">*</span></label>
            <input type="text" id="birthDate" class="date-input" required placeholder="Û±Û³Û·Û°/Û°Û±/Û°Û±">
          </div>
          <div>
            <label>Ø´Ù‡Ø± Ù…Ø­Ù„ ØªÙˆÙ„Ø¯</label>
            <input type="text" id="birthCity">
          </div>
          <div>
            <label>Ø¬Ù†Ø³ÛŒØª</label>
            <select id="gender">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
              <option>Ù…Ø±Ø¯</option>
              <option>Ø²Ù†</option>
            </select>
          </div>
          <div>
            <label>ÙˆØ¶Ø¹ÛŒØª ØªØ§Ù‡Ù„</label>
            <select id="marital">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
              <option>Ù…Ø¬Ø±Ø¯</option>
              <option>Ù…ØªØ§Ù‡Ù„</option>
              <option>Ø³Ø§ÛŒØ±</option>
            </select>
          </div>
          <div>
            <label>Ù‚Ø¯ (cm)</label>
            <input type="number" id="height" min="30" max="300">
          </div>
          <div>
            <label>ÙˆØ²Ù† (kg)</label>
            <input type="number" id="weight" min="10" max="500">
          </div>
          <div>
            <label>Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡ Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ</label>
            <select id="drivingLicense">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
              <option>ÙØ§Ù‚Ø¯ Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡</option>
              <option>Ù¾Ø§ÛŒÙ‡ ÛŒÚ©</option>
              <option>Ù¾Ø§ÛŒÙ‡ Ø¯Ùˆ</option>
              <option>Ù¾Ø§ÛŒÙ‡ Ø³Ù‡</option>
              <option>ÙˆÛŒÚ˜Ù‡</option>
            </select>
          </div>
          <div>
            <label>ÙˆØ¶Ø¹ÛŒØª Ù†Ø¸Ø§Ù… ÙˆØ¸ÛŒÙÙ‡</label>
            <select id="military">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
              <option>Ù¾Ø§ÛŒØ§Ù† Ø®Ø¯Ù…Øª</option>
              <option>Ù…Ø¹Ø§ÙÛŒØª Ù¾Ø²Ø´Ú©ÛŒ</option>
              <option>Ù…Ø¹Ø§ÙÛŒØª Ø¯Ø§Ø¦Ù…</option>
            </select>
          </div>
          <div>
            <label>Ù…Ø­Ù„ Ø®Ø¯Ù…Øª (Ø¨Ø±Ø§ÛŒ Ù†Ø¸Ø§Ù… ÙˆØ¸ÛŒÙÙ‡)</label>
            <select id="militaryPlace">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
              <option>Ø§ØµÙÙ‡Ø§Ù†</option>
              <option>ØªÙ‡Ø±Ø§Ù†</option>
              <option>Ù…Ø´Ù‡Ø¯</option>
              <option>Ø´ÛŒØ±Ø§Ø²</option>
              <option>Ø³Ø§ÛŒØ±</option>
            </select>
          </div>
        </div>
      </div>

      <!-- ØªØ­ØµÛŒÙ„Ø§Øª -->
      <div style="margin-top:12px">
        <div class="section-title">ØªØ­ØµÛŒÙ„Ø§Øª</div>
        <div class="grid">
          <div>
            <label>ØªØ­ØµÛŒÙ„Ø§Øª</label>
            <select id="education">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
              <option>Ø²ÛŒØ± Ø¯ÛŒÙ¾Ù„Ù…</option>
              <option>Ø¯ÛŒÙ¾Ù„Ù…</option>
              <option>Ú©Ø§Ø±Ø¯Ø§Ù†ÛŒ</option>
              <option>Ú©Ø§Ø±Ø´Ù†Ø§Ø³ÛŒ</option>
              <option>Ø¯Ú©ØªØ±ÛŒ</option>
              <option>Ø­ÙˆØ²ÙˆÛŒ</option>
            </select>
          </div>
          <div>
            <label>Ø±Ø´ØªÙ‡ ØªØ­ØµÛŒÙ„ÛŒ</label>
            <input type="text" id="major">
          </div>
        </div>
      </div>

      <!-- Ø²Ø¨Ø§Ù† -->
      <div style="margin-top:12px">
        <div class="section-title">Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§</div>
        <div class="grid">
          <div>
            <label>Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ â€” Ø®ÙˆØ§Ù†Ø¯Ù†/Ù†ÙˆØ´ØªÙ†</label>
            <select id="engReading">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
              <option>Ø¶Ø¹ÛŒÙ</option>
              <option>Ø®ÙˆØ¨</option>
              <option>Ø¹Ø§Ù„ÛŒ</option>
            </select>
          </div>
          <div>
            <label>Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ â€” Ù…Ú©Ø§Ù„Ù…Ù‡</label>
            <select id="engSpeaking">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
              <option>Ø¶Ø¹ÛŒÙ</option>
              <option>Ø®ÙˆØ¨</option>
              <option>Ø¹Ø§Ù„ÛŒ</option>
            </select>
          </div>

          <div>
            <label>Ø²Ø¨Ø§Ù† Ø¯ÙˆÙ… (Ù†Ø§Ù…)</label>
            <input type="text" id="secondLangName">
          </div>
          <div>
            <label>Ø²Ø¨Ø§Ù† Ø¯ÙˆÙ… â€” Ù…Ú©Ø§Ù„Ù…Ù‡</label>
            <select id="secondLangSpeak">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
              <option>Ø¶Ø¹ÛŒÙ</option>
              <option>Ø®ÙˆØ¨</option>
              <option>Ø¹Ø§Ù„ÛŒ</option>
            </select>
          </div>
          <div>
            <label>Ø²Ø¨Ø§Ù† Ø¯ÙˆÙ… â€” Ø®ÙˆØ§Ù†Ø¯Ù†/Ù†ÙˆØ´ØªÙ†</label>
            <select id="secondLangRead">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
              <option>Ø¶Ø¹ÛŒÙ</option>
              <option>Ø®ÙˆØ¨</option>
              <option>Ø¹Ø§Ù„ÛŒ</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Ø³ÙˆØ§Ø¨Ù‚ Ø´ØºÙ„ÛŒ -->
      <div style="margin-top:12px">
        <div class="section-title">Ø³ÙˆØ§Ø¨Ù‚ Ø´ØºÙ„ÛŒ</div>
        <div>
          <div class="employment-list" id="employmentList">
            <!-- Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
          </div>
          <div class="actions" style="margin-top:8px">
            <button type="button" id="addEmployment">Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø§Ø¨Ù‚Ù‡ Ø´ØºÙ„ÛŒ</button>
            <button type="button" id="clearEmployments" class="secondary">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡</button>
          </div>
        </div>
      </div>

      <!-- Ù…Ø¹Ø±Ù -->
      <div style="margin-top:12px">
        <div class="section-title">Ù…Ø¹Ø±Ù</div>
        <div class="grid">
          <div>
            <label>Ù†Ø§Ù… Ù…Ø¹Ø±Ù</label>
            <input type="text" id="refFirst">
          </div>
          <div>
            <label>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ù…Ø¹Ø±Ù</label>
            <input type="text" id="refLast">
          </div>
          <div>
            <label>Ø´ØºÙ„ Ù…Ø¹Ø±Ù</label>
            <input type="text" id="refJob">
          </div>
          <div>
            <label>ØªÙ„ÙÙ† ØªÙ…Ø§Ø³ Ù…Ø¹Ø±Ù</label>
            <input type="tel" id="refPhone">
          </div>
        </div>
      </div>

      <!-- ÙˆØ§Ø¨Ø³ØªÚ¯Ø§Ù† Ø´Ø§ØºÙ„ Ø¯Ø± Ø´Ø±Ú©Øª -->
      <div style="margin-top:12px">
        <div class="section-title">ÙˆØ§Ø¨Ø³ØªÚ¯Ø§Ù† Ø´Ø§ØºÙ„ Ø¯Ø± Ø´Ø±Ú©Øª Ø³Ø§Ù…Ø§Ù†</div>
        <div class="grid">
          <div>
            <label>Ù†Ø§Ù…</label>
            <input type="text" id="relativeFirst">
          </div>
          <div>
            <label>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
            <input type="text" id="relativeLast">
          </div>
          <div>
            <label>Ø´ØºÙ„/Ø³Ù…Øª</label>
            <input type="text" id="relativeJob">
          </div>
          <div>
            <label>Ù†Ø³Ø¨Øª</label>
            <input type="text" id="relativeRelation">
          </div>
        </div>
      </div>

      <!-- Ù…Ù‡Ø§Ø±Øª Ù‡Ø§ -->
      <div style="margin-top:12px">
        <div class="section-title">Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ØªØ®ØµØµÛŒ</div>
        <div class="grid">
          <div>
            <label>Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ØªØ®ØµØµÛŒ (Ú©Ø§Ø¯Ø± Ø¬Ù„Ùˆ)</label>
            <input type="text" id="skills">
          </div>
          <div>
            <label>Ù…Ù‡Ø§Ø±Øª Ø±Ø§ÛŒØ§Ù†Ù‡â€ŒØ§ÛŒ</label>
            <select id="itSkill">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
              <option>Ø§ØµÙ„Ø§ Ø¢Ø´Ù†Ø§ÛŒÛŒ Ù†Ø¯Ø§Ø±Ù…</option>
              <option>Ø¯Ø± Ø­Ø¯ Ø¯Ø±ÙˆØ³ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡</option>
              <option>Ø¯ÙˆØ±Ù‡ ICDL Ø±Ø§ Ú¯Ø°Ø±Ø§Ù†Ø¯Ù…</option>
              <option>Ø¯ÙˆØ±Ù‡ IT</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Ù…Ø­Ù„ Ø³Ú©ÙˆÙ†Øª -->
      <div style="margin-top:12px">
        <div class="section-title">Ù…Ø­Ù„ Ø³Ú©ÙˆÙ†Øª</div>
        <div class="grid">
          <div>
            <label>Ø§Ø³ØªØ§Ù†</label>
            <input type="text" id="province">
          </div>
          <div>
            <label>Ø¢Ø¯Ø±Ø³</label>
            <textarea id="address"></textarea>
          </div>
          <div>
            <label>Ú©Ø¯ Ù¾Ø³ØªÛŒ</label>
            <input type="text" id="postal">
          </div>
          <div>
            <label>ØªÙ„ÙÙ† Ø«Ø§Ø¨Øª</label>
            <input type="tel" id="phone">
          </div>
          <div>
            <label>ØªÙ„ÙÙ† Ù‡Ù…Ø±Ø§Ù‡ <span class="required">*</span></label>
            <input type="tel" id="mobile" required>
          </div>
        </div>
      </div>

      <!-- Ø¯Ú©Ù…Ù‡ Ù‡Ø§ -->
      <div class="footer card" style="align-items:center;">
        <div class="small">Ù¾Ø³ Ø§Ø² ØªÚ©Ù…ÛŒÙ„ØŒ Ø±ÙˆÛŒ Ø«Ø¨Øª Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù…Ø§ÛŒØ§Ù† Ø´ÙˆØ¯ Ùˆ Ø¨ØªÙˆØ§Ù†ÛŒØ¯ PDF Ø¨Ú¯ÛŒØ±ÛŒØ¯.</div>
        <div class="actions">
          <button type="submit" id="submitBtn">Ø«Ø¨Øª</button>
          <button type="button" id="downloadPdf" class="secondary">Ø¯Ø±ÛŒØ§ÙØª PDF</button>
          <button type="button" id="resetBtn" class="muted">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…</button>
        </div>
      </div>
    </form>

    <!-- Ù¾ÛŒØ´ Ù†Ù…Ø§ÛŒØ´ Ùˆ Ø®Ø±ÙˆØ¬ÛŒ -->
    <div id="previewArea" class="card" style="display:none; margin-top:12px;">
      <div class="section-title">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</div>
      <div id="previewContent" class="preview"></div>
      <div style="margin-top:12px" class="actions">
        <button id="downloadPdf2">Ú¯Ø±ÙØªÙ† PDF Ø§Ø² Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´</button>
      </div>
    </div>

  </div>

  <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>


  <script>
    // init jalali datepicker Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„Ø¯ ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯
    window.addEventListener('load', ()=>{
      if(window.$ === undefined){
        // persian-datepicker Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ jQuery Ù†Ø¯Ø§Ø±Ø¯ Ø§Ø² API Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      }
      try {
        var birth = document.getElementById('birthDate');
        // persianDatepicker expects jQuery â€” but our CDN provides a version that can be invoked directly:
        if (typeof $(birth).pDatepicker === 'function') {
          $(birth).pDatepicker({format: 'YYYY/MM/DD', initialValueType: 'gregorian'});
        } else if (window.persianDate && window.persianDate.toLocale) {
          // fallback: no fancy picker available â€” leave as text input
        }
      } catch(e){
        // ignore â€” input remains text
      }
    });

    // Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙˆØ§Ø¨Ù‚ Ø´ØºÙ„ÛŒ Ù¾ÙˆÛŒØ§
    const employmentList = document.getElementById('employmentList');
    document.getElementById('addEmployment').addEventListener('click', addEmployment);
    document.getElementById('clearEmployments').addEventListener('click', ()=>{ employmentList.innerHTML = ''; });

    function addEmployment(data = {}) {
      const idx = Date.now();
      const div = document.createElement('div');
      div.className = 'employment-item';
      div.innerHTML = `
        <div class="inline" style="justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Ø³Ø§Ø¨Ù‚Ù‡ Ø´ØºÙ„ÛŒ</strong>
          <div style="display:flex;gap:8px">
            <button type="button" class="secondary btnRemove">Ø­Ø°Ù</button>
          </div>
        </div>
        <div class="grid">
          <div><label>Ù…Ø­Ù„ Ø®Ø¯Ù…Øª</label><input type="text" class="emp_place" value="${data.place||''}"></div>
          <div><label>Ø³Ù…Øª</label><input type="text" class="emp_title" value="${data.title||''}"></div>
          <div><label>ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ (Ø´Ù…Ø³ÛŒ)</label><input type="text" class="emp_start date-input" value="${data.start||''}"></div>
          <div><label>ØªØ§Ø±ÛŒØ® Ø®Ø§ØªÙ…Ù‡ (Ø´Ù…Ø³ÛŒ)</label><input type="text" class="emp_end date-input" value="${data.end||''}"></div>
          <div><label>Ù†Ø­ÙˆÙ‡ Ù‡Ù…Ú©Ø§Ø±ÛŒ</label><input type="text" class="emp_type" value="${data.type||''}"></div>
          <div><label>Ø¹Ù„Øª Ù‚Ø·Ø¹ Ù‡Ù…Ú©Ø§Ø±ÛŒ</label><input type="text" class="emp_reason" value="${data.reason||''}"></div>
        </div>
      `;
      employmentList.appendChild(div);

      div.querySelector('.btnRemove').addEventListener('click', ()=> div.remove());
    }

    // Ø§ÙØ²ÙˆØ¯Ù† ÛŒÚ© Ø±Ú©ÙˆØ±Ø¯ Ø®Ø§Ù„ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø±Ø§Ø­ØªÛŒ Ú©Ø§Ø±Ø¨Ø±
    addEmployment();

    // Ù‡Ù†Ú¯Ø§Ù… submit -> Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ØŒ ÙˆÙ„ÛŒØ¯ÛŒØ´Ù† Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´
    const form = document.getElementById('applyForm');
    const previewArea = document.getElementById('previewArea');
    const previewContent = document.getElementById('previewContent');

    form.addEventListener('submit', function(e){
      e.preventDefault();
      const valid = form.checkValidity();
      if(!valid){
        alert('Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ú©Ù†ÛŒØ¯ (Ø³ØªØ§Ø±Ù‡â€ŒØ¯Ø§Ø±).');
        form.reportValidity();
        return;
      }
      const data = collectFormData();
      showPreview(data);
    });

    document.getElementById('downloadPdf').addEventListener('click', ()=>{
      const data = collectFormData();
      showPreview(data);
      // small delay to render preview
      setTimeout(()=> generatePdfFromPreview(), 300);
    });
    document.getElementById('downloadPdf2').addEventListener('click', generatePdfFromPreview);

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      if(confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ ÙØ±Ù… Ù¾Ø§Ú© Ø´ÙˆØ¯ØŸ')) {
        form.reset();
        employmentList.innerHTML = '';
        addEmployment();
        previewArea.style.display = 'none';
      }
    });

    function collectFormData(){
      const get = id => document.getElementById(id).value.trim();
      const data = {
        header: 'Ø´Ø±Ú©Øª Ø®Ø¯Ù…Ø§Øª Ù‡ÙˆØ§ÛŒÛŒ Ø³Ø§Ù…Ø§Ù† - Ø§ØµÙÙ‡Ø§Ù†',
        firstName: get('firstName'),
        lastName: get('lastName'),
        fatherName: get('fatherName'),
        nationalId: get('nationalId'),
        shenasnameh: get('shenasnameh'),
        birthDate: get('birthDate'),
        birthCity: get('birthCity'),
        gender: get('gender'),
        marital: get('marital'),
        height: get('height'),
        weight: get('weight'),
        drivingLicense: get('drivingLicense'),
        military: get('military'),
        militaryPlace: get('militaryPlace'),
        education: get('education'),
        major: get('major'),
        engReading: get('engReading'),
        engSpeaking: get('engSpeaking'),
        secondLangName: get('secondLangName'),
        secondLangSpeak: get('secondLangSpeak'),
        secondLangRead: get('secondLangRead'),
        skills: get('skills'),
        itSkill: get('itSkill'),
        province: get('province'),
        address: get('address'),
        postal: get('postal'),
        phone: get('phone'),
        mobile: get('mobile'),
        refFirst: get('refFirst'),
        refLast: get('refLast'),
        refJob: get('refJob'),
        refPhone: get('refPhone'),
        relativeFirst: get('relativeFirst'),
        relativeLast: get('relativeLast'),
        relativeJob: get('relativeJob'),
        relativeRelation: get('relativeRelation'),
        employments: []
      };

      // collect employments
      Array.from(document.querySelectorAll('.employment-item')).forEach(item=>{
        const e = {
          place: item.querySelector('.emp_place').value.trim(),
          title: item.querySelector('.emp_title').value.trim(),
          start: item.querySelector('.emp_start').value.trim(),
          end: item.querySelector('.emp_end').value.trim(),
          type: item.querySelector('.emp_type').value.trim(),
          reason: item.querySelector('.emp_reason').value.trim()
        };
        // if any field present consider it
        if(Object.values(e).some(v=>v)) data.employments.push(e);
      });

      return data;
    }

    function showPreview(data){
      let txt = '';
      txt += `Ø¹Ù†ÙˆØ§Ù†: ${data.header}\n\n`;
      txt += `Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ:\n`;
      txt += `Ù†Ø§Ù…: ${data.firstName}  Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ: ${data.lastName}\n`;
      txt += `Ù†Ø§Ù… Ù¾Ø¯Ø±: ${data.fatherName}  Ú©Ø¯Ù…Ù„ÛŒ: ${data.nationalId}\n`;
      txt += `Ø´Ù…Ø§Ø±Ù‡ Ø´Ù†Ø§Ø³Ù†Ø§Ù…Ù‡: ${data.shenasnameh}  ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯ (Ø´Ù…Ø³ÛŒ): ${data.birthDate}\n`;
      txt += `Ø´Ù‡Ø± Ù…Ø­Ù„ ØªÙˆÙ„Ø¯: ${data.birthCity}  Ø¬Ù†Ø³ÛŒØª: ${data.gender}\n`;
      txt += `ÙˆØ¶Ø¹ÛŒØª ØªØ§Ù‡Ù„: ${data.marital}  Ù‚Ø¯: ${data.height} cm  ÙˆØ²Ù†: ${data.weight} kg\n`;
      txt += `Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡: ${data.drivingLicense}  ÙˆØ¶Ø¹ÛŒØª Ù†Ø¸Ø§Ù… ÙˆØ¸ÛŒÙÙ‡: ${data.military}  Ù…Ø­Ù„ Ø®Ø¯Ù…Øª: ${data.militaryPlace}\n\n`;

      txt += `ØªØ­ØµÛŒÙ„Ø§Øª:\nØªØ­ØµÛŒÙ„Ø§Øª: ${data.education}  Ø±Ø´ØªÙ‡: ${data.major}\n\n`;

      txt += `Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§:\nØ§Ù†Ú¯Ù„ÛŒØ³ÛŒ â€” Ø®ÙˆØ§Ù†Ø¯Ù†/Ù†ÙˆØ´ØªÙ†: ${data.engReading}  Ù…Ú©Ø§Ù„Ù…Ù‡: ${data.engSpeaking}\n`;
      txt += `Ø²Ø¨Ø§Ù† Ø¯ÙˆÙ…: ${data.secondLangName}  Ø®ÙˆØ§Ù†Ø¯Ù†/Ù†ÙˆØ´ØªÙ†: ${data.secondLangRead}  Ù…Ú©Ø§Ù„Ù…Ù‡: ${data.secondLangSpeak}\n\n`;

      txt += `Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§:\nÙ…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ØªØ®ØµØµÛŒ: ${data.skills}\nÙ…Ù‡Ø§Ø±Øª Ø±Ø§ÛŒØ§Ù†Ù‡â€ŒØ§ÛŒ: ${data.itSkill}\n\n`;

      txt += `Ø³ÙˆØ§Ø¨Ù‚ Ø´ØºÙ„ÛŒ (${data.employments.length}):\n`;
      data.employments.forEach((e,i)=>{
        txt += `#${i+1} â€” Ù…Ø­Ù„: ${e.place}  Ø³Ù…Øª: ${e.title}  Ø§Ø²: ${e.start}  ØªØ§: ${e.end}  Ù†Ø­ÙˆÙ‡ Ù‡Ù…Ú©Ø§Ø±ÛŒ: ${e.type}  Ø¹Ù„Øª Ù‚Ø·Ø¹: ${e.reason}\n`;
      });
      if(data.employments.length===0) txt += 'Ù†Ø¯Ø§Ø±Ø¯\n';
      txt += `\nÙ…Ø¹Ø±Ù:\n${data.refFirst} ${data.refLast}  Ø´ØºÙ„: ${data.refJob}  ØªÙ„ÙÙ†: ${data.refPhone}\n\n`;

      txt += `ÙˆØ§Ø¨Ø³ØªÚ¯Ø§Ù† Ø´Ø§ØºÙ„ Ø¯Ø± Ø´Ø±Ú©Øª:\n${data.relativeFirst} ${data.relativeLast} â€” Ø³Ù…Øª: ${data.relativeJob} â€” Ù†Ø³Ø¨Øª: ${data.relativeRelation}\n\n`;

      txt += `Ù…Ø­Ù„ Ø³Ú©ÙˆÙ†Øª:\nØ§Ø³ØªØ§Ù†: ${data.province}\nØ¢Ø¯Ø±Ø³: ${data.address}\nÚ©Ø¯Ù¾Ø³ØªÛŒ: ${data.postal}\nØªÙ„ÙÙ† Ø«Ø§Ø¨Øª: ${data.phone}\nØªÙ„ÙÙ† Ù‡Ù…Ø±Ø§Ù‡: ${data.mobile}\n`;

      previewContent.textContent = txt;
      previewArea.style.display = 'block';
      // scroll to preview
      previewArea.scrollIntoView({behavior:'smooth'});
    }


function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  return text.replace(/[&<>"']/g, m => map[m]);
}
    
async function generatePdfFromPreview(){
  if(previewArea.style.display === 'none'){
    alert('Ø§Ø¨ØªØ¯Ø§ ÙØ±Ù… Ø±Ø§ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯');
    return;
  }

  const element = document.createElement('div');
  element.style.direction = 'rtl';
  element.style.fontFamily = 'Vazir, Tahoma, sans-serif';
  element.style.padding = '18px';
  element.style.background = '#fff';
  element.innerHTML =
    `<pre style="white-space:pre-wrap;">${escapeHtml(previewContent.textContent)}</pre>`;

  const opt = {
    margin: 10,
    filename: "Form.pdf",
    image: { type: "jpeg", quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
  };

  const pdfBlob = await html2pdf()
      .set(opt)
      .from(element)
      .output('blob');


  // Ø§Ø±Ø³Ø§Ù„ Ù…Ø³ØªÙ‚ÛŒÙ… PDF Ø¨Ù‡ Ø§ÛŒÙ…ÛŒÙ„
  await sendPdfToEmail(pdfBlob);
}
async function sendPdfToEmail(pdfBlob) {
    const reader = new FileReader();

reader.onloadend = async function() {
    const base64 = reader.result.replace(/^data:application\/pdf;base64,/, "");

    // ğŸ”¥ Ø§ÛŒÙ† Ø¯Ùˆ Ø®Ø· Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
    console.log("BASE64 LENGTH:", base64.length);
    console.log("BASE64 START:", base64.substring(0, 100));

    await fetch("https://script.google.com/macros/s/AKfycbz1y6zJ3jjku-OZQHTHF_SyCHw6bdMc7qRPrnfQJq9rvrsTD38SmrjZba0RAoYDIE6J/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ pdf: base64 })
    });

    alert("PDF Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ âœ”");
};

reader.readAsDataURL(pdfBlob);

}




  </script>
</body>
</html>
